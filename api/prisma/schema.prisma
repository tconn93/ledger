// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Client model - represents a business entity
model Client {
  id        String   @id @default(uuid())
  name      String
  email     String?  @unique
  phone     String?
  address   String?
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  users        User[]
  accounts     Account[]
  transactions Transaction[]

  @@index([email])
}

// User model - one user per client
model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  firstName    String
  lastName     String
  active       Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Foreign keys
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([clientId])
}

// Account Types: Asset, Liability, Equity, Revenue, Expense
enum AccountType {
  ASSET
  LIABILITY
  EQUITY
  REVENUE
  EXPENSE
}

// Chart of Accounts
model Account {
  id          String      @id @default(uuid())
  code        String      // e.g., "1000", "2000"
  name        String      // e.g., "Cash", "Accounts Receivable"
  type        AccountType
  description String?
  active      Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Foreign keys
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  // Relations
  ledgerEntries LedgerEntry[]

  @@unique([clientId, code])
  @@index([clientId, type])
}

// Transaction represents a business event (invoice, payment, etc.)
model Transaction {
  id          String   @id @default(uuid())
  date        DateTime
  description String
  reference   String?  // Invoice number, check number, etc.
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Foreign keys
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  // Relations
  ledgerEntries LedgerEntry[]

  @@index([clientId, date])
}

// Ledger Entry - implements double-entry bookkeeping
model LedgerEntry {
  id        String   @id @default(uuid())
  amount    Decimal  @db.Decimal(15, 2)
  type      String   // "DEBIT" or "CREDIT"
  createdAt DateTime @default(now())

  // Foreign keys
  transactionId String
  transaction   Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  accountId String
  account   Account @relation(fields: [accountId], references: [id], onDelete: Restrict)

  @@index([transactionId])
  @@index([accountId])
}
